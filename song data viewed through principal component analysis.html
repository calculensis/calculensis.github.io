<!DOCTYPE html>
<!--[if lt IE 7]>      <html class="no-js lt-ie9 lt-ie8 lt-ie7"> <![endif]-->
<!--[if IE 7]>         <html class="no-js lt-ie9 lt-ie8"> <![endif]-->
<!--[if IE 8]>         <html class="no-js lt-ie9"> <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js"> <!--<![endif]-->
    <head>
        <meta charset="utf-8">
        <title>    song data viewed through principal component analysis
</title>
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <link href='https://fonts.googleapis.com/css?family=Gentium+Book+Basic|Merriweather:400,300' rel='stylesheet' type='text/css'>
        <link rel="stylesheet" href="https://www.thedecisionblog.com/theme/css/cid.css">
        <link href="https://www.thedecisionblog.com/feeds/all.atom.xml" type="application/atom+xml" rel="alternate" title="the decision blog Atom Feed" />
    </head>
    <body>
        <!--[if lt IE 7]>
            <p class="chromeframe">You are using an <strong>outdated</strong> browser. Please <a href="http://browsehappy.com/">upgrade your browser</a> or <a href="http://www.google.com/chromeframe/?redirect=true">activate Google Chrome Frame</a> to improve your experience.</p>
        <![endif]-->

            <div class="container">

<header class="blog-header">
    <h1><a href="https://www.thedecisionblog.com">the decision blog</a></h1>
    <p></p>
    <nav>
        <a href="https://www.thedecisionblog.com/">INDEX</a>
        <a href="https://www.thedecisionblog.com/archives">ARCHIVES</a>
        <a href="https://www.thedecisionblog.com/categories">CATEGORIES</a>
    </nav>
</header>

    <div class="post">

        <header>
            <h1>song data viewed through principal component analysis</h1>
            <p class="date">Written on <time datetime="2022-12-21T00:00:00-05:00">Dec 21, 2022</time></p>
        </header>

        <article>
            <p><img align=right src="images/guitar.jpg" width="200"/></p>
<p>Today we use principal component analysis to explore Spotify data for songs written between 1950 and 2010. The data are in separate files (called 1950.csv, 1960.csv, etc) for each decade; we start by combining them into a single data frame.</p>
<div class="highlight"><pre><span></span><code><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>

<span class="n">data_frames</span> <span class="o">=</span> <span class="p">{}</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1950</span><span class="p">,</span><span class="mi">2011</span><span class="p">,</span><span class="mi">10</span><span class="p">):</span>
    <span class="n">data_frames</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;.csv&#39;</span><span class="p">)</span>
    <span class="n">data_frames</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">data_frames</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">drop</span><span class="p">([</span><span class="s1">&#39;Number&#39;</span><span class="p">],</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

<span class="n">songs</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">data_frames</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>  \
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1950</span><span class="p">,</span><span class="mi">2011</span><span class="p">,</span><span class="mi">10</span><span class="p">)])</span>
<span class="nb">print</span><span class="p">(</span><span class="n">songs</span><span class="o">.</span><span class="n">head</span><span class="p">())</span>
</code></pre></div>

<div class="highlight"><pre><span></span><code>                                               title               artist  \
0                       Put Your Head On My Shoulder            Paul Anka   
1  Whatever Will Be Will Be (Que Sera Sera) (with...            Doris Day   
2                           Everybody Loves Somebody          Dean Martin   
3        Take Good Care Of My Baby - 1990 Remastered            Bobby Vee   
4                                 A Teenager In Love  Dion &amp; The Belmonts

         top genre  year  bpm  nrgy  dnce  dB  live  val  dur  acous  spch  \
0  adult standards  2000  116    34    55  -9    10   47  155     75     3   
1  adult standards  1948  177    34    42 -11    72   78  123     86     4   
2  adult standards  2013   81    49    26  -9    34   40  162     81     4   
3  adult standards  2011   82    43    49 -12    12   66  151     70     6   
4  adult standards  1959   79    38    56  -9    13   62  158     67     3

   pop  
0   72  
1   62  
2   61  
3   60  
4   60
</code></pre></div>

<p>The fields with unobvious meanings are: bpm = beats per minute; nrgy = energy level; dnce = danceability; dB = loudness; live = liveness (with a higher number meaning higher a likelihood of the recording being live); val = valence (with a higher number corresponding to a higher positive mood); dur = duration; acous = acousticness; spch = speechiness (higher means more spoken words); pop = popularity.</p>
<p>We extract the numerical fields and see how many principal components we need to explain various percentages of the data.</p>
<div class="highlight"><pre><span></span><code><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">seaborn</span> <span class="k">as</span> <span class="nn">sns</span><span class="p">;</span> <span class="n">sns</span><span class="o">.</span><span class="n">set</span><span class="p">()</span>
<span class="kn">from</span> <span class="nn">sklearn.decomposition</span> <span class="kn">import</span> <span class="n">PCA</span>

<span class="n">songs</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;all_years.csv&#39;</span><span class="p">)</span>
<span class="n">pca</span> <span class="o">=</span> <span class="n">PCA</span><span class="p">()</span>

<span class="n">X</span> <span class="o">=</span> <span class="n">songs</span><span class="o">.</span><span class="n">drop</span><span class="p">([</span><span class="s1">&#39;title&#39;</span><span class="p">,</span><span class="s1">&#39;artist&#39;</span><span class="p">,</span><span class="s1">&#39;top genre&#39;</span><span class="p">],</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

<span class="o">%</span><span class="n">matplotlib</span> <span class="n">inline</span>
<span class="n">pca</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">cumsum</span><span class="p">(</span><span class="n">pca</span><span class="o">.</span><span class="n">explained_variance_ratio_</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;number of components (minus 1)&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;cumulative explained variance&#39;</span><span class="p">)</span>
</code></pre></div>

<div class="highlight"><pre><span></span><code><span class="n">Text</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mf">0.5</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;cumulative explained variance&#39;</span><span class="p">)</span><span class="w"></span>
</code></pre></div>

<p><img alt="png" src="./images/explained_variances.png"></p>
<p>We see that about 70% of the data can be explained by two principal components (note that the first component is labeled "0"). Let's express the data in terms of these component directions and group the result by genre.</p>
<div class="highlight"><pre><span></span><code><span class="n">pca</span> <span class="o">=</span> <span class="n">PCA</span><span class="p">(</span><span class="mf">0.70</span><span class="p">)</span>
<span class="n">pca</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>
<span class="n">X_pca</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">pca</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">X</span><span class="p">))</span>
<span class="n">X_pca</span><span class="p">[</span><span class="s1">&#39;genre&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">songs</span><span class="p">[</span><span class="s1">&#39;top genre&#39;</span><span class="p">]</span>
<span class="n">genre_pca</span> <span class="o">=</span> <span class="n">X_pca</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;genre&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="n">genre_pca</span><span class="o">.</span><span class="n">head</span><span class="p">())</span>
</code></pre></div>

<div class="highlight"><pre><span></span><code>                          0          1
genre                                 
acoustic blues    65.129148 -10.982230
adult standards  -45.261659  30.869426
afrobeat         -64.351904 -26.235664
afropop          178.522942  64.016836
album rock        33.228259  -4.024576
</code></pre></div>

<p>So, for example, acoustic blues and afropop load high on principal component zero while, of these two, only afropop loads high on principal component one. We can see how these values relate to, say danceability, with a scatter plot.</p>
<div class="highlight"><pre><span></span><code><span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">X_pca</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span><span class="mi">0</span><span class="p">],</span><span class="n">X_pca</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span><span class="mi">1</span><span class="p">],</span><span class="n">s</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> \
            <span class="n">c</span><span class="o">=</span><span class="n">songs</span><span class="p">[</span><span class="s1">&#39;dnce&#39;</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;pca0&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;pca1&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">()</span>
</code></pre></div>

<div class="highlight"><pre><span></span><code>&lt;matplotlib.colorbar.Colorbar at 0x7fbe0136d460&gt;
</code></pre></div>

<p><img alt="png" src="./images/danceability.png"></p>
<p>The more danceable genres tend to load low on principal component 1. We can see which genres are the most and least danceable by querying the data:</p>
<div class="highlight"><pre><span></span><code><span class="n">high_dnce</span> <span class="o">=</span> <span class="p">(</span><span class="n">genre_pca</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">&lt;</span><span class="mi">0</span><span class="p">)</span>
<span class="n">genre_pca</span><span class="p">[</span><span class="n">high_dnce</span><span class="p">]</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</code></pre></div>

<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>0</th>
      <th>1</th>
    </tr>
    <tr>
      <th>genre</th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>acoustic blues</th>
      <td>65.129148</td>
      <td>-10.982230</td>
    </tr>
    <tr>
      <th>afrobeat</th>
      <td>-64.351904</td>
      <td>-26.235664</td>
    </tr>
    <tr>
      <th>album rock</th>
      <td>33.228259</td>
      <td>-4.024576</td>
    </tr>
    <tr>
      <th>alternative metal</th>
      <td>1.633728</td>
      <td>-31.132024</td>
    </tr>
    <tr>
      <th>alternative r&amp;b</th>
      <td>-15.708144</td>
      <td>-22.355832</td>
    </tr>
  </tbody>
</table>
</div>

<div class="highlight"><pre><span></span><code><span class="n">low_dnce</span> <span class="o">=</span> <span class="p">(</span><span class="n">genre_pca</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">&gt;</span><span class="mf">50.0</span><span class="p">)</span>
<span class="n">genre_pca</span><span class="p">[</span><span class="n">low_dnce</span><span class="p">]</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</code></pre></div>

<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>0</th>
      <th>1</th>
    </tr>
    <tr>
      <th>genre</th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>afropop</th>
      <td>178.522942</td>
      <td>64.016836</td>
    </tr>
    <tr>
      <th>avant-garde jazz</th>
      <td>213.712463</td>
      <td>140.855648</td>
    </tr>
    <tr>
      <th>bebop</th>
      <td>160.565217</td>
      <td>104.111861</td>
    </tr>
    <tr>
      <th>blues</th>
      <td>229.492590</td>
      <td>74.519282</td>
    </tr>
    <tr>
      <th>british folk</th>
      <td>-18.102521</td>
      <td>61.018127</td>
    </tr>
  </tbody>
</table>
</div>

<p>Let's repeat the same steps for popularity:</p>
<div class="highlight"><pre><span></span><code><span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">X_pca</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span><span class="mi">0</span><span class="p">],</span><span class="n">X_pca</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span><span class="mi">1</span><span class="p">],</span><span class="n">s</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> \
            <span class="n">c</span><span class="o">=</span><span class="n">songs</span><span class="p">[</span><span class="s1">&#39;pop&#39;</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;pca0&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;pca1&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">()</span>
</code></pre></div>

<div class="highlight"><pre><span></span><code>&lt;matplotlib.colorbar.Colorbar at 0x7fbe000a4790&gt;
</code></pre></div>

<p><img alt="png" src="./images/popularity.png"></p>
<div class="highlight"><pre><span></span><code><span class="n">most_pop</span> <span class="o">=</span> <span class="p">(</span><span class="n">genre_pca</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">&gt;-</span><span class="mi">50</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">genre_pca</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">&lt;</span><span class="mi">100</span><span class="p">)</span>
<span class="n">genre_pca</span><span class="p">[</span><span class="n">most_pop</span><span class="p">]</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</code></pre></div>

<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>0</th>
      <th>1</th>
    </tr>
    <tr>
      <th>genre</th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>acoustic blues</th>
      <td>65.129148</td>
      <td>-10.982230</td>
    </tr>
    <tr>
      <th>adult standards</th>
      <td>-45.261659</td>
      <td>30.869426</td>
    </tr>
    <tr>
      <th>album rock</th>
      <td>33.228259</td>
      <td>-4.024576</td>
    </tr>
    <tr>
      <th>alternative country</th>
      <td>-40.116761</td>
      <td>33.310572</td>
    </tr>
    <tr>
      <th>alternative metal</th>
      <td>1.633728</td>
      <td>-31.132024</td>
    </tr>
  </tbody>
</table>
</div>

<div class="highlight"><pre><span></span><code><span class="n">least_pop</span> <span class="o">=</span> <span class="p">(</span><span class="n">genre_pca</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">&gt;-</span><span class="mi">150</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">genre_pca</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">&lt;-</span><span class="mi">50</span><span class="p">)</span>
<span class="n">genre_pca</span><span class="p">[</span><span class="n">least_pop</span><span class="p">]</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</code></pre></div>

<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>0</th>
      <th>1</th>
    </tr>
    <tr>
      <th>genre</th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>afrobeat</th>
      <td>-64.351904</td>
      <td>-26.235664</td>
    </tr>
    <tr>
      <th>american folk revival</th>
      <td>-64.653072</td>
      <td>22.946793</td>
    </tr>
    <tr>
      <th>appalachian folk</th>
      <td>-70.237852</td>
      <td>-0.487309</td>
    </tr>
    <tr>
      <th>australian rock</th>
      <td>-58.740034</td>
      <td>-4.316319</td>
    </tr>
    <tr>
      <th>australian talent show</th>
      <td>-103.017823</td>
      <td>-35.674851</td>
    </tr>
  </tbody>
</table>
</div>

<p>Of course we could have found out the same things by querying the original data. The main point of these scatter plots is to build a bridge between the data expressed in pca coordinates and the original features, to make the pca coordinates more interpretable. And the main strength of principal component analysis is that we can filter out noise or make an otherwise computationally prohibitive problem much more tractible by lowering the number of features a model would have to deal with.</p>
<p><a href="https://twitter.com/Estimatrix/status/1555693184977600512?s=20&amp;t=YFPoxpEQ2Qp14U4FliD7fA">Discuss on Twitter</a></p>
        </article>

        <footer>
            <p>This entry is posted in <a href="https://www.thedecisionblog.com/category/machine-learning.html">machine learning</a>.</p>
        </footer>


    </div>


<footer class="blog-footer">

    <ul class="nav">
                <li><a href="https://www.thedecisionblog.com/about">about</a></li>
                <li><a href="https://www.thedecisionblog.com/hire me">hire me</a></li>
    </ul>

    <p class="disclaimer">
    Built with <a href="http://getpelican.com">Pelican</a>, and <a href="https://github.com/hdra/Pelican-Cid">Cid</a> theme.
    </p>
</footer>
            </div>
<script>
    var _gaq=[['_setAccount','UA-234119846-1'],['_trackPageview']];
    (function(d,t){var g=d.createElement(t),s=d.getElementsByTagName(t)[0];
    g.src=('https:'==location.protocol?'//ssl':'//www')+'.google-analytics.com/ga.js';
    s.parentNode.insertBefore(g,s)}(document,'script'));
</script>
    </body>
</html>